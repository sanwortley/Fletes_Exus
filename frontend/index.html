<!-- index.html --> 
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fletes Larga Distancia ‚Äî Fletes y Mudanzas en C√≥rdoba</title>

  <!-- Tipograf√≠as pro -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=DM+Sans:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary:#ffcc00;
      --bg:#000;
      --text:#fff;
      --muted:#ccc;
      --card:#111;
      --radius:20px;
    }

    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      letter-spacing:.1px;
      background: var(--bg);
      color: var(--text);
      line-height:1.6;
    }

    /* ===== Header sticky ===== */
    header{
      position: sticky; top:0; z-index:50;
      background:linear-gradient(180deg,#000 0%, #000 85%, rgba(0,0,0,.86) 100%);
      display:flex; justify-content:space-between; align-items:center;
      padding:16px 24px;
      border-bottom:1px solid rgba(255,204,0,.35);
      backdrop-filter: blur(6px);
    }
    header b{
      color:var(--primary); font-size:1.4rem; letter-spacing:.5px;
      font-family:"DM Sans", Inter, sans-serif; font-weight:700;
    }
    nav a{
      color:#fff; text-decoration:none; margin-left:10px; padding:6px 10px;
      font-weight:600; opacity:.9; transition:.2s; border-radius:10px;
    }
    nav a:hover{ opacity:1; color:var(--primary); background:rgba(255,204,0,.12); }

    .container{ max-width:1120px; margin:40px auto; padding:0 20px; }

    /* ===== Hero ===== */
    .hero{
      background:#0e0e0e; border:1px solid #1e1e1e; border-radius:var(--radius);
      padding:44px 28px; text-align:center;
      box-shadow:0 10px 30px rgba(0,0,0,.6), 0 0 0 1px rgba(255,204,0,.08) inset;
    }
    .hero h1{
      color:var(--primary); font-size:2.2rem; margin-bottom:12px;
      line-height:1.15; letter-spacing:.2px; font-family:"DM Sans", Inter, sans-serif;
    }
    .hero p{ font-size:1.08rem; max-width:680px; margin:0 auto 20px; color:#eaeaea; opacity:.92; }
    .btn{
      background:var(--primary); color:#000; font-weight:800; text-decoration:none;
      padding:12px 22px; border-radius:14px; display:inline-block; transition:.25s;
      box-shadow:0 8px 22px rgba(255,204,0,.25);
    }
    .btn:hover{ background:#e6b800; transform:translateY(-1px) scale(1.05); }

    /* ===== Carrusel ===== */
    .carousel{
      position:relative; width:100%;
      aspect-ratio:16/9; border-radius:18px; overflow:hidden;
      margin:28px auto 0; box-shadow:0 4px 18px rgba(0,0,0,.5); background:#000;
    }
    @supports not (aspect-ratio:16/9){
      .carousel{ height:340px; }
    }
    .slide{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      opacity:0; transition:opacity .6s ease; background:#000;
    }
    .slide.active{ opacity:1; }
    .slide img{ width:100%; height:100%; object-fit:contain; display:block; background:#000; }

    /* Slide croquis tipo ficha t√©cnica */
    .slide--blueprint{ background:#111; padding:12px; }
    .slide--blueprint .frame{
      width:min(900px, 92%); height:100%; background:#fff; border-radius:18px;
      display:flex; align-items:center; justify-content:center; margin:auto;
      box-shadow:0 12px 30px rgba(0,0,0,.45);
    }
    .slide--blueprint img{ width:96%; height:auto; object-fit:contain; background:#fff; }

    .controls{
      position:absolute; bottom:12px; left:50%; transform:translateX(-50%);
      display:flex; gap:10px; z-index:2;
    }
    .dot{
      width:8px; height:8px; border-radius:999px; border:0; cursor:pointer;
      background:rgba(255,255,255,.45); box-shadow:0 1px 2px rgba(0,0,0,.4);
      transition:width .2s ease, background .2s ease;
    }
    .dot.active{ width:22px; background:var(--primary); }

    /* ===== Cards ===== */
    .cards{
      display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:24px; margin-top:46px;
    }
    .card{
      background:linear-gradient(180deg,#111 0%, #0d0d0d 100%);
      border:1px solid #1f1f1f; border-radius:20px; padding:22px;
      box-shadow:0 2px 10px rgba(0,0,0,.4);
      transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .card:hover{
      transform:translateY(-2px);
      box-shadow:0 12px 28px rgba(0,0,0,.45);
      border-color:rgba(255,204,0,.25);
    }
    .card h2{
      color:var(--primary); margin-bottom:12px; font-size:1.2rem;
      display:flex; align-items:center; gap:10px; font-weight:800;
      letter-spacing:.2px; font-family:"DM Sans", Inter, sans-serif;
    }
    .card h2::before{
      content:""; width:10px; height:10px; border-radius:50%;
      background:var(--primary); box-shadow:0 0 0 4px rgba(255,204,0,.15);
    }

    /* Bullets accesibles sin emojis */
    .features{ list-style:none; padding-left:0; margin:10px 0 0; }
    .features li{
      display:flex; align-items:center; gap:10px;
      margin:10px 0; color:#ddd; font-size:18px;
    }
    .features .bullet{
      width:12px; height:12px; border-radius:50%;
      background:var(--primary); flex:0 0 12px;
      box-shadow:0 0 0 4px rgba(255,204,0,.08);
    }

    /* ===== Footer ===== */
    footer{
      background:#080808; border-top:1px solid rgba(255,204,0,.3);
      padding:30px 20px; margin-top:60px; text-align:center;
    }
    .footer-title{ color:var(--primary); font-weight:800; font-size:1.15rem; margin-bottom:10px; letter-spacing:.2px; }
    .social{ display:flex; justify-content:center; gap:20px; margin:14px 0; }
    .social a{
      color:var(--text); text-decoration:none; display:inline-flex; align-items:center; justify-content:center;
      width:38px; height:38px; border-radius:50%; border:1px solid #222; background:#121212; transition:.2s;
    }
    .social a:hover{ border-color:var(--primary); box-shadow:0 0 0 2px rgba(255,204,0,.15); }
    .social a svg{ width:20px; height:20px; fill:#fff; }
    .footer-info{ color:#bdbdbd; font-size:.92rem; margin-top:8px; }

    /* ===== CTA WhatsApp flotante ===== */
    .whatsapp-float{
      position:fixed; width:56px; height:56px; bottom:24px; right:24px;
      background-color:#25D366; color:#fff; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      box-shadow:0 8px 24px rgba(37,211,102,.35); z-index:100; text-decoration:none; transition:.2s;
    }
    .whatsapp-float:hover{ transform:translateY(-1px) scale(1.08); }
    .whatsapp-float svg{ width:30px; height:30px; fill:#fff; }
  </style>
</head>

<body>
<header>
  <b>Fletes Larga Distancia</b>
  <nav>
    <a href="/index" data-view="/index">Inicio</a>
    <a href="/presupuesto" data-view="/presupuesto">Presupuesto</a>
    <a href="/admin" data-view="/admin">Admin</a>
  </nav>
</header>

  <main class="container">
    <!-- Hero -->
    <section class="hero">
      <h1>Fletes y Mudanzas en C√≥rdoba</h1>
      <p>Peque√±a empresa familiar con atenci√≥n inmediata, confiabilidad y puntualidad. Presupuesto fijo por viaje, sin importar distancia ni horas.</p>
      <a href="/presupuesto" class="btn" data-view="/presupuesto">Calcular presupuesto</a>

    </section>

    <!-- Carrusel -->
    <section class="carousel" id="carousel">
      <!-- Slide croquis (ficha t√©cnica) -->
      <figure class="slide slide--blueprint active">
        <div class="frame">
          <img loading="lazy" src="/static/images/animado.jpeg" alt="Croquis t√©cnico del cami√≥n con medidas 3 m de largo y 1,7 m de ancho">
        </div>
      </figure>

      <figure class="slide">
        <img loading="lazy" src="/static/images/camion1.jpeg" alt="Cami√≥n en servicio 1">
      </figure>

      <figure class="slide">
        <img loading="lazy" src="/static/images/camion10.png" alt="Cami√≥n en servicio 10">
      </figure>

      <figure class="slide">
        <img loading="lazy" src="/static/images/camion2.jpeg" alt="Cami√≥n de mudanza 2">
      </figure>

      <figure class="slide">
        <img loading="lazy" src="/static/images/camion3.jpeg" alt="Cami√≥n en servicio 3">
      </figure>

      <figure class="slide">
        <img loading="lazy" src="/static/images/camion5.jpeg" alt="Cami√≥n en servicio 5">
      </figure>

      <figure class="slide">
        <img loading="lazy" src="/static/images/camion11.png" alt="Cami√≥n en servicio 11">
      </figure>

      <figure class="slide">
        <img loading="lazy" src="/static/images/camion8.jpeg" alt="Cami√≥n de mudanza 8">
      </figure>

      <figure class="slide">
        <img loading="lazy" src="/static/images/camion9.jpeg" alt="Cami√≥n en servicio 9">
      </figure>

      <div class="controls" id="dots"></div>
    </section>

    <!-- Cards -->
    <section class="cards">
      <div class="card">
        <h2>Nuestra capacidad</h2>
        <ul class="features">
          <li><span class="bullet"></span> Hasta 10 m¬≥ de carga.</li>
          <li><span class="bullet"></span> Hasta 1.2 toneladas.</li>
        </ul>
      </div>

      <div class="card">
        <h2>Servicios</h2>
        <ul class="features">
          <li><span class="bullet"></span> Fletes y mudanzas locales o interurbanas.</li>
          <li><span class="bullet"></span> Presupuesto fijo por viaje.</li>
          <li><span class="bullet"></span> Tiempo estimado del traslado incluido.</li>
        </ul>
      </div>

      <div class="card">
        <h2>Compromiso</h2>
        <ul class="features">
          <li><span class="bullet"></span> Atenci√≥n familiar y personalizada.</li>
          <li><span class="bullet"></span> Confiabilidad y puntualidad garantizadas.</li>
          <li><span class="bullet"></span> Presupuesto inmediato sin demoras.</li>
        </ul>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <div class="footer-title">Contactanos</div>
    <div class="social">
      <!-- WhatsApp -->
      <a href="https://wa.me/5493516678989" target="_blank" title="WhatsApp" aria-label="WhatsApp">
        <svg viewBox="0 0 32 32" role="img" aria-hidden="true"><path d="M16 3C9.372 3 4 8.372 4 15c0 2.115.55 4.103 1.514 5.837L4 29l8.377-1.472A11.91 11.91 0 0 0 16 27c6.628 0 12-5.372 12-12S22.628 3 16 3zm0 2c5.523 0 10 4.477 10 10s-4.477 10-10 10a9.9 9.9 0 0 1-3.987-.832l-.284-.12-.298.052-4.2.738.748-4.104.053-.29-.143-.257A9.9 9.9 0 0 1 6 15c0-5.523 4.477-10 10-10zm5.053 13.873c-.275-.138-1.63-.806-1.875-.898-.244-.092-.422-.138-.6.138-.18.275-.694.956-.85 1.15-.156.193-.312.206-.575.07-.275-.138-1.158-.426-2.213-1.362-.818-.72-1.373-1.61-1.534-1.894-.162-.281-.02-.436.118-.593.122-.122.275-.318.412-.48.138-.162.18-.275.275-.468.092-.193.046-.35-.023-.504-.07-.156-.6-1.448-.825-1.984-.218-.52-.444-.448-.606-.456-.156-.008-.336-.01-.516-.01-.18 0-.47.068-.716.34-.244.275-.932.91-.932 2.222 0 1.312.956 2.58 1.09 2.758.138.18 2.01 3.07 4.85 4.284.68.296 1.21.472 1.63.604.686.218 1.312.187 1.81.114.552-.082 1.69-.69 1.944-1.355.244-.664.244-1.238.172-1.35-.07-.11-.26-.18-.55-.32z"/></svg>
      </a>
      <!-- Instagram -->
      <a href="https://www.instagram.com/fletes_largadistancia" target="_blank" title="Instagram" aria-label="Instagram">
        <svg viewBox="0 0 24 24" role="img" aria-hidden="true"><path d="M12 2.2c3.2 0 3.6 0 4.9.1 1.2.1 1.9.2 2.3.4.6.2 1 .4 1.5.9.5.5.7.9.9 1.5.2.4.3 1.1.4 2.3.1 1.3.1 1.7.1 4.9s0 3.6-.1 4.9c-.1 1.2-.2 1.9-.4 2.3-.2.6-.4 1-.9 1.5-.5.5-.9.7-1.5.9-.4.2-1.1.3-2.3.4-1.3.1-1.7.1-4.9.1s-3.6 0-4.9-.1c-1.2-.1-1.9-.2-2.3-.4-.6-.2-1-.4-1.5-.9-.5-.5-.7-.9-.9-1.5-.2-.4-.3-1.1-.4-2.3C2.2 15.6 2.2 15.2 2.2 12s0-3.6.1-4.9c.1-1.2.2-1.9.4-2.3.2-.6.4-1 .9-1.5.5-.5.9-.7 1.5-.9.4-.2 1.1-.3 2.3-.4C8.4 2.2 8.8 2.2 12 2.2m0-1.7C8.7.5 8.3.5 7 .6 5.7.7 4.8.9 4.1 1.2c-.8.3-1.5.7-2.2 1.4C1.3 3.2.9 3.9.6 4.7c-.3.7-.5 1.6-.6 2.9C0 8.8 0 9.3 0 12s0 3.2.1 4.5c.1 1.3.3 2.2.6 2.9.3.8.7 1.5 1.4 2.2.7.7 1.4 1.1 2.2 1.4.7.3 1.6.5 2.9.6 1.3.1 1.8.1 4.5.1s3.2 0 4.5-.1c1.3-.1 2.2-.3 2.9-.6.8-.3 1.5-.7 2.2-1.4.7-.7 1.1-1.4 1.4-2.2.3-.7.5-1.6.6-2.9.1-1.3.1-1.8.1-4.5s0-3.2-.1-4.5c-.1-1.3-.3-2.2-.6-2.9-.3-.8-.7-1.5-1.4-2.2-.7-.7-1.4-1.1-2.2-1.4-.7-.3-1.6-.5-2.9-.6C15.2.5 14.7.5 12 .5z"/><path d="M12 5.8A6.2 6.2 0 1 0 12 18.2 6.2 6.2 0 1 0 12 5.8zm0 10.2A4 4 0 1 1 12 8a4 4 0 0 1 0 8z"/><circle cx="18.4" cy="5.6" r="1.4"/></svg>
      </a>
      <!-- Correo (compose Gmail) -->
      <a href="https://mail.google.com/mail/?view=cm&fs=1&to=fletesjavier@gmail.com&su=Consulta%20desde%20la%20web&body=Hola%20Javier%2C%20quiero%20pedir%20un%20presupuesto%20para%20un%20flete."
         target="_blank" rel="noopener" title="Correo" aria-label="Correo">
        <svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5L4 8V6l8 5 8-5v2z"/></svg>
      </a>
      <!-- Tel√©fono -->
      <a href="tel:+5493516678989" title="Llamar" aria-label="Tel√©fono">
        <svg viewBox="0 0 24 24" role="img" aria-hidden="true"><path d="M6.6 10.8a15.1 15.1 0 0 0 6.6 6.6l2.2-2.2c.3-.3.8-.4 1.2-.2 1.3.5 2.7.8 4.1.8.7 0 1.2.5 1.2 1.2V21c0 .7-.5 1.2-1.2 1.2C10.4 22.2 1.8 13.6 1.8 2.4 1.8 1.7 2.3 1.2 3 1.2H6c.7 0 1.2.5 1.2 1.2 0 1.4.3 2.8.8 4.1.1.4 0 .9-.3 1.2L6.6 10.8z"/></svg>
      </a>
    </div>
    <div class="footer-info">
      ¬© 2025 Fletes Larga Distancia ¬∑ C√≥rdoba, Argentina <br/>
      Atenci√≥n r√°pida, confiable y con presupuesto inmediato.
    </div>
  </footer>

  <!-- CTA WhatsApp flotante -->
  <a class="whatsapp-float"
     href="https://wa.me/5493516678989?text=Hola%20Javier,%20necesito%20un%20presupuesto"
     target="_blank" aria-label="WhatsApp">
    <svg viewBox="0 0 32 32"><path d="M16 3C9.372 3 4 8.372 4 15c0 2.115.55 4.103 1.514 5.837L4 29l8.377-1.472A11.91 11.91 0 0 0 16 27c6.628 0 12-5.372 12-12S22.628 3 16 3zm0 2c5.523 0 10 4.477 10 10s-4.477 10-10 10a9.9 9.9 0 0 1-3.987-.832l-.284-.12-.298.052-4.2.738.748-4.104.053-.29-.143-.257A9.9 9.9 0 0 1 6 15c0-5.523 4.477-10 10-10zm5.053 13.873c-.275-.138-1.63-.806-1.875-.898-.244-.092-.422-.138-.6.138-.18.275-.694.956-.85 1.15-.156.193-.312.206-.575.07-.275-.138-1.158-.426-2.213-1.362-.818-.72-1.373-1.61-1.534-1.894-.162-.281-.02-.436.118-.593.122-.122.275-.318.412-.48.138-.162.18-.275.275-.468.092-.193.046-.35-.023-.504-.07-.156-.6-1.448-.825-1.984-.218-.52-.444-.448-.606-.456-.156-.008-.336-.01-.516-.01-.18 0-.47.068-.716.34-.244.275-.932.91-.932 2.222 0 1.312.956 2.58 1.09 2.758.138.18 2.01 3.07 4.85 4.284.68.296 1.21.472 1.63.604.686.218 1.312.187 1.81.114.552-.082 1.69-.69 1.944-1.355.244-.664.244-1.238.172-1.35-.07-.11-.26-.18-.55-.32z"/></svg>
  </a>

  <!-- JS Carrusel -->
  <script>
  (function () {
    const root = document.getElementById('carousel');
    if (!root) return;

    const slides = Array.from(root.querySelectorAll('.slide'));
    const dotsWrap = document.getElementById('dots');
    if (!slides.length) return;

    let i = 0;
    let timer = null;

    // dots
    if (dotsWrap) {
      dotsWrap.innerHTML = '';
      slides.forEach((_, idx) => {
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'dot' + (idx === 0 ? ' active' : '');
        b.addEventListener('click', () => go(idx, true));
        dotsWrap.appendChild(b);
      });
    }

    function setActive(idx) {
      slides.forEach((s, k) => s.classList.toggle('active', k === idx));
      if (dotsWrap) {
        dotsWrap.querySelectorAll('.dot').forEach((d, k) => d.classList.toggle('active', k === idx));
      }
      i = idx;
    }

    function next() { setActive((i + 1) % slides.length); }
    function go(idx, reset) { setActive(idx); if (reset) restart(); }
    function restart() {
      if (timer) clearInterval(timer);
      timer = setInterval(next, 3500);
    }

    // pausa hover
    root.addEventListener('mouseenter', () => timer && clearInterval(timer));
    root.addEventListener('mouseleave', restart);

    setActive(0);
    restart();
  })();
</script>

  <script>
  (function(){
    // ‚úÖ API_BASE sin redeclarar
    globalThis.API_BASE = globalThis.API_BASE || (
      (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
        ? 'http://127.0.0.1:8000'
        : 'https://fletes-exus.onrender.com'
    );

    let token = null;
    let solicitudes = [];
    let selected = null;
    let isAuth = false;

    const q = (s)=>document.querySelector(s);
    const toast = (msg)=>{const t=q('#toast'); if(!t) return; t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2200)};
    const peso = (n)=> (n!=null ? ('$ ' + Number(n).toLocaleString('es-AR')) : '-');

    // üëá NUEVO: gateo para saber si estamos en la vista Admin
    function isAdminView(){
      return !!(document.getElementById('loginForm')
             && document.getElementById('authFlag')
             && document.getElementById('tbody'));
    }

    function badge(estadoRaw){
      const e = (estadoRaw || 'pendiente').toLowerCase();
      const texto = e.charAt(0).toUpperCase() + e.slice(1);
      const cls = e==='confirmado' ? 'aprobado' : (e==='rechazado' ? 'rechazado' : 'pendiente');
      return `<span class="badge ${cls}">${texto}</span>`;
    }

    // ‚¨áÔ∏è CAMBIADO: null-safe y gateado
    function setAuthUI(isOn){
      if (!isAdminView()) return;
      isAuth = !!isOn;
      const flag = document.getElementById('authFlag');
      if (flag){
        flag.textContent = isOn ? 'Autenticado' : 'No autenticado';
        flag.className   = 'tag ' + (isOn ? 'ok' : 'muted');
      }
      const btn = document.getElementById('btnLogout');
      if (btn){
        btn.style.display = isOn ? 'inline-flex' : 'none';
      }
    }

    async function login(){
      if (!isAdminView()) return;
      const username = document.getElementById('usr')?.value.trim();
      const password = document.getElementById('pwd')?.value.trim();
      if(!username || !password){ toast('Ingres√° usuario y contrase√±a'); return; }
      try{
        const res = await fetch(`${API_BASE}/api/login`, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        if(!res.ok) throw new Error(data.detail || 'Credenciales inv√°lidas');
        token = data.token;
        setAuthUI(true);
        toast('Sesi√≥n iniciada');
        await loadSolicitudes();
      }catch(e){ toast(e.message || 'Error de login'); }
    }

    // ‚¨áÔ∏è CAMBIADO: limpia estado SIEMPRE y s√≥lo toca DOM si es Admin
    function logout(reason){
      token = null; isAuth = false; selected = null; solicitudes = [];
      if (!isAdminView()) return;
      setAuthUI(false);
      renderEmpty(reason || 'Inici√° sesi√≥n para ver las solicitudes de presupuesto.');
      const usr = document.getElementById('usr');
      const pwd = document.getElementById('pwd');
      if (usr) usr.value = '';
      if (pwd) pwd.value = '';
      if (usr) usr.focus();
    }

    async function loadSolicitudes(){
      if (!isAdminView()) return;
      if(!token){ renderEmpty('Inici√° sesi√≥n para ver las solicitudes de presupuesto.'); return; }
      try{
        const res = await fetch(`${API_BASE}/api/requests`, { headers:{'Authorization':`Bearer ${token}`} });
        const data = await res.json();
        if(!res.ok) throw new Error(data.detail || 'No se pudieron cargar las solicitudes');
        solicitudes = Array.isArray(data.items) ? data.items : [];
        render();
        if(solicitudes.length===0) renderEmpty('No hay solicitudes.');
      }catch(e){ renderEmpty(e.message || 'No se pudieron cargar las solicitudes.'); }
    }

    function render(){
      if (!isAdminView()) return;
      const tb = document.getElementById('tbody');
      if (!tb) return;
      tb.innerHTML = '';
      for(const s of solicitudes){
        const tr = document.createElement('tr');
        tr.className = 'row';
        tr.innerHTML = `
          <td><div class="client"><span class="name">${s.nombre_cliente || '-'}</span><span class="sub">${s.telefono || '-'}</span></div></td>
          <td>${s.tipo_carga || '-'}</td>
          <td>${s.fecha || '-'}</td>
          <td>${badge(s.estado)}</td>
          <td><div class="actions"><button class="btn-ghost" onclick="openModal('${s.id}')" type="button">Detalles</button></div></td>
        `;
        tb.appendChild(tr);
      }
    }

    // ‚¨áÔ∏è CAMBIADO: gateado
    function renderEmpty(msg){
      if (!isAdminView()) return;
      const tb = document.getElementById('tbody');
      if (!tb) return;
      tb.innerHTML = `<tr><td colspan="5" class="empty">${msg}</td></tr>`;
    }

    function coalesce(...vals){ for(const v of vals){ if(v!==undefined && v!==null) return v; } return null; }

    // ‚¨áÔ∏è CAMBIADO: gateado
    function openModal(id){
      if (!isAdminView()) return;
      if(!token){ logout(); return; }
      selected = solicitudes.find(s => String(s.id) === String(id));
      if(!selected) return;

      const tiempo_viaje_min = coalesce(
        selected.tiempo_viaje_min,
        selected.tramo_base_origen_min && selected.tramo_origen_destino_min
          ? Number(selected.tramo_base_origen_min) + Number(selected.tramo_origen_destino_min) + Number(selected.tramo_destino_base_min || 0)
          : null
      );
      const tiempo_servicio_min = coalesce(selected.tiempo_servicio_min, null);
      const tiempo_carga_desc_min = coalesce(selected.tiempo_carga_descarga_min, selected.tiempo_servicio_min);
      const costo_tiempo = coalesce(
        selected.costo_tiempo,
        (selected.costo_tiempo_base!=null && selected.mantenimiento!=null)
          ? (Number(selected.costo_tiempo_base) + Number(selected.mantenimiento))
          : null
      );

      document.getElementById('#m_cliente')?.textContent;
      (document.getElementById('m_cliente')||{}).textContent = selected.nombre_cliente || '-';
      (document.getElementById('m_tel')||{}).textContent = selected.telefono || '-';
      (document.getElementById('m_tipo')||{}).textContent = selected.tipo_carga || '-';
      (document.getElementById('m_fecha')||{}).textContent = selected.fecha || '-';
      (document.getElementById('m_ayudante')||{}).textContent = selected.ayudante ? 'S√≠' : 'No';
      (document.getElementById('m_estado')||{}).textContent = selected.estado || '-';
      (document.getElementById('m_origen')||{}).textContent = selected.origen || '-';
      (document.getElementById('m_destino')||{}).textContent = selected.destino || '-';

      (document.getElementById('m_dist_km')||{}).textContent = (selected.dist_km!=null ? Number(selected.dist_km).toFixed(3).replace('.', ',') : '-');
      (document.getElementById('m_tiempo_viaje')||{}).textContent = (tiempo_viaje_min!=null ? `${tiempo_viaje_min} min` : '-');
      (document.getElementById('m_tiempo_servicio')||{}).textContent = (tiempo_servicio_min!=null ? `${tiempo_servicio_min} min` : '-');
      (document.getElementById('m_tiempo_carga_desc')||{}).textContent = (tiempo_carga_desc_min!=null ? `${tiempo_carga_desc_min} min` : '-');

      (document.getElementById('m_costo_tiempo')||{}).textContent = peso(costo_tiempo);
      (document.getElementById('m_costo_combustible')||{}).textContent = peso(selected.costo_combustible);
      (document.getElementById('m_costo_ayudante')||{}).textContent = peso(selected.costo_ayudante);
      (document.getElementById('m_total')||{}).textContent = peso(selected.monto_estimado);

      const ov = document.getElementById('overlay');
      if (ov) ov.classList.add('open');
    }

    function closeModal(){ document.getElementById('overlay')?.classList.remove('open'); selected = null; }

    async function aprobar(){
      if(!selected || !token) return;
      try{
        const res = await fetch(`${API_BASE}/api/requests/${selected.id}/confirm`, {
          method:'POST',
          headers:{'Authorization':`Bearer ${token}`}
        });
        const data = await res.json();
        if(!res.ok) throw new Error(data.detail || 'No se pudo confirmar');
        toast('Solicitud confirmada ‚úÖ');
        closeModal(); await loadSolicitudes();
      }catch(e){toast(e.message || 'Error al confirmar')}
    }

    async function rechazar(){
      if(!selected || !token) return;
      try{
        const res = await fetch(`${API_BASE}/api/requests/${selected.id}/reject`, {
          method:'POST',
          headers:{'Authorization':`Bearer ${token}`,'Content-Type':'application/json'}
        });
        const data = await res.json();
        if(!res.ok) throw new Error(data.detail || 'No se pudo rechazar');
        toast('Solicitud rechazada');
        closeModal(); await loadSolicitudes();
      }catch(e){toast(e.message || 'Error al rechazar')}
    }

    async function eliminar(){
      if(!selected || !token) return;
      if((selected.estado||'').toLowerCase() !== 'rechazado'){ toast('Solo se puede eliminar si est√° Rechazado'); return; }
      if(!confirm(`¬øEliminar la solicitud de "${selected.nombre_cliente}"? Esta acci√≥n no se puede deshacer.`)) return;
      try{
        const res = await fetch(`${API_BASE}/api/requests/${selected.id}`, {
          method:'DELETE',
          headers:{'Authorization':`Bearer ${token}`}
        });
        const data = await res.json();
        if(!res.ok) throw new Error(data.detail || 'No se pudo eliminar');
        toast('Solicitud eliminada');
        closeModal(); await loadSolicitudes();
      }catch(e){toast(e.message || 'Error al eliminar')}
    }

    function forceLoginOnTabEnter(){
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') logout('Por seguridad, inici√° sesi√≥n nuevamente.');
      });
      window.addEventListener('pageshow', (ev) => { if (ev.persisted) logout('Por seguridad, inici√° sesi√≥n nuevamente.'); });
      let armed = false;
      window.addEventListener('blur', () => { armed = true; });
      window.addEventListener('focus', () => { if (isAuth && armed) logout('Por seguridad, inici√° sesi√≥n nuevamente.'); armed = false; });
      window.addEventListener('beforeunload', () => { token = null; isAuth = false; });
      document.querySelectorAll('a[href]').forEach(a => { a.addEventListener('click', () => { token = null; isAuth = false; }); });
    }

    // ‚¨áÔ∏è CAMBIADO: s√≥lo inicializa si la vista Admin existe
    (function initAdmin(){
      function ready(){
        if (!isAdminView()) return;
        logout();
        forceLoginOnTabEnter();
        document.getElementById('loginForm')?.addEventListener('submit', (e) => { e.preventDefault(); login(); });
      }
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', ready, { once: true });
      } else {
        ready();
      }
    })();

    // üëá Exponer SOLO lo que usan los onclick del HTML
    Object.assign(window, { openModal, closeModal, aprobar, rechazar, eliminar, logout });
  })();
  </script>

  <script defer src="/static/spa.js"></script>
</body>
</html>
